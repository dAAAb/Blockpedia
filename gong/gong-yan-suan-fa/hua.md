---
description: 雙花問題（Double Spending）是數位貨幣的核心挑戰——如何防止同一筆錢被花兩次？比特幣首次解決了這個問題。
---

# 雙花問題

### 你手上有一張百元鈔票。當你把它交給店家，鈔票就不在你手上了——這就是為什麼實體貨幣不會有雙花問題。但數位檔案可以無限複製。如果數位貨幣可以被複製，誰會相信它有價值？

---

## 什麼是雙花問題？

| 概念 | 說明 |
|------|------|
| 定義 | 同一筆數位貨幣被使用兩次 |
| 為何重要 | 如果可以雙花，貨幣就沒價值 |
| 核心挑戰 | 數位資料可以被複製 |

---

## 問題說明

```
雙花攻擊的場景：

1. Alice 有 1 BTC
2. Alice 同時發送給 Bob 和 Carol
   - 交易 A：Alice → Bob 1 BTC
   - 交易 B：Alice → Carol 1 BTC
3. 兩筆交易幾乎同時廣播
4. 哪筆算數？

問題：
- 沒有中央機構裁決
- 兩筆交易看起來都合法
- 必須只能有一筆成功
```

---

## 傳統解決方案

### 中心化方法

| 方法 | 說明 |
|------|------|
| 銀行 | 中央帳本記錄餘額 |
| PayPal | 公司維護交易記錄 |
| 信用卡 | 發卡機構驗證 |

```
中心化解決方案：

用戶 → 銀行 → 驗證餘額 → 完成交易

優點：簡單、快速
缺點：必須信任中央機構
      - 銀行可能倒閉
      - 可能被審查
      - 單點故障
```

{% hint style="info" %}
**為什麼需要去中心化？**

中心化解決方案需要信任第三方。比特幣的目標是創造不需要信任任何人的貨幣系統。
{% endhint %}

---

## 比特幣的解決方案

### 核心機制

| 機制 | 作用 |
|------|------|
| 區塊鏈 | 公開的交易記錄 |
| 工作量證明 | 決定交易順序 |
| 最長鏈規則 | 確定哪筆交易有效 |
| 確認數 | 交易不可逆轉的程度 |

### 運作方式

```
比特幣如何防止雙花：

1. 所有交易廣播到全網
2. 礦工競爭打包區塊
3. 首先被打包的交易有效
4. 後來的衝突交易被拒絕
5. 隨著確認增加，回滾越難

時間線：
交易 A ────┐
           ├─→ 區塊 N（包含 A）→ A 有效
交易 B ────┘
           ↓
           B 被拒絕（與 A 衝突）
```

---

## 確認數的重要性

### 確認數與安全性

| 確認數 | 風險 | 適合 |
|--------|------|------|
| 0 確認 | 高風險 | 不建議 |
| 1 確認 | 中風險 | 小額 |
| 3 確認 | 低風險 | 一般交易 |
| 6 確認 | 極低風險 | 大額交易 |

```
確認數的數學：

假設攻擊者有 10% 算力：
- 1 確認：約 10% 成功率
- 3 確認：約 0.1% 成功率
- 6 確認：約 0.0001% 成功率

確認越多，回滾越難
```

{% hint style="warning" %}
**0 確認的風險**

在交易被打包進區塊之前（0 確認），雙花攻擊相對容易。不要接受 0 確認的大額交易。
{% endhint %}

---

## 雙花攻擊類型

### 常見攻擊

| 攻擊 | 說明 | 防禦 |
|------|------|------|
| Race Attack | 同時發送兩筆交易 | 等待確認 |
| Finney Attack | 礦工預挖區塊 | 等待確認 |
| 51% 攻擊 | 控制多數算力 | 對大鏈無效 |

### 51% 攻擊

```
51% 攻擊流程：

1. 攻擊者控制 51% 算力
2. 在私有鏈上挖礦
3. 同時向商家付款
4. 商家確認後給貨
5. 公布私有鏈（更長）
6. 原交易被推翻
7. 攻擊者拿回錢又拿到貨

為什麼比特幣安全？
- 需要天文數字的算力
- 成本遠超收益
- 攻擊成功會摧毀 BTC 價值
```

---

## PoS 的雙花防禦

### 質押機制

| 機制 | 說明 |
|------|------|
| Slashing | 作惡會被沒收質押 |
| 最終性 | 確定後不可回滾 |
| 經濟成本 | 攻擊需要大量代幣 |

---

## 延伸閱讀

- [拜占庭將軍問題](bai-zhan-ting.md) — 分散式信任問題
- [工作量證明](../gong-zuo-liang-ming.md) — PoW 如何防止雙花
- [共識機制](../README.md) — 共識總覽

---

#### 參考資料

- [Bitcoin Whitepaper](https://bitcoin.org/bitcoin.pdf)
- [Double Spending 分析](https://bitcoin.org/en/glossary/double-spend)

